generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Perfil {
  ADMIN
  USUARIO
}

enum Status {
  ATIVO
  INATIVO
  CANCELADO
}

enum StatusCertificado {
  PENDENTE
  LIBERADO
}

model Usuario {
  id           Int            @id @default(autoincrement())
  nome         String         @db.VarChar(100)
  email        String         @unique @db.VarChar(100)
  senha        String         @db.VarChar(100)
  perfil       Perfil         @default(USUARIO)
  dataCadastro DateTime?      @default(now()) @map("dt_cadastro") @db.Timestamp(0)
  avatar       String?        @db.VarChar(60)
  Participante Participante[]
  Certificado  Certificado[]

  @@map("usuario")
}

model Evento {
  id              Int            @id @default(autoincrement())
  nome            String         @db.VarChar(100)
  descricao       String?        @db.Text
  dataInicio      DateTime       @map("dt_inicio") @db.Timestamp(0)
  dataFim         DateTime       @map("dt_fim") @db.Timestamp(0)
  local           String         @db.VarChar(100)
  quantidateHoras Int            @map("qtd_horas")
  quantidadeVagas Int?           @map("qtd_vagas")
  status          Status         @default(ATIVO)
  imagem          String?        @db.VarChar(120)
  dataCadastro    DateTime?      @default(now()) @map("dt_cadastro") @db.Timestamp(0)
  Participante    Participante[]
  Certificado     Certificado[]

  @@map("evento")
}

model Certificado {
  id           Int               @id @default(autoincrement())
  usuarioId    Int               @map("usuario_id")
  eventoId     Int               @map("evento_id")
  inscricaoId  Int               @map("inscricao_id")
  status       StatusCertificado @default(PENDENTE)
  dataCadastro DateTime?         @default(now()) @map("dt_cadastro") @db.Timestamp(0)
  url          String?           @db.VarChar(60)

  Usuario      Usuario      @relation(fields: [usuarioId], references: [id])
  Evento       Evento       @relation(fields: [eventoId], references: [id])
  Participante Participante @relation(fields: [inscricaoId], references: [id])

  @@map("certificado")
}

model Participante {
  id          Int           @id @default(autoincrement())
  numero      String        @map("numero_inscricao") @db.VarChar(20)
  usuarioId   Int           @map("usuario_id")
  eventoId    Int           @map("evento_id")
  dataInsc    DateTime      @map("dt_inscricao") @db.Timestamp(0) @default(dbgenerated("CURRENT_DATE"))
  Certificado Certificado[]

  Usuario Usuario @relation(fields: [usuarioId], references: [id])
  Evento  Evento  @relation(fields: [eventoId], references: [id])

  @@map("participante")
}